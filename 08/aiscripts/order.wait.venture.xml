<?xml version="1.0" encoding="iso-8859-1" ?>
<aiscript name="order.wait.venture" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="aiscripts.xsd">

  <order id="WaitForVenture" name="{1041, 751}" description="{1041, 752}" category="internal">
    <params>
      <param name="ventureplatform" type="internal" default="null" text="'Venture Platform'" comment="Venture Platform the ship is expected to venture from" />
      <param name="debugchance" type="bool" default="0" advanced="true" text="{1041, 10086}" comment="Print debug output">
        <input_param name="truevalue" value="100"/>
      </param>
    </params>
  </order>
  <attention min="unknown">
    <actions>
      <label name="start" />

      <do_if value="$ventureplatform and $ventureplatform.ventureships.indexof.{this.assignedcontrolled} == 0">
        <debug_text text="'Ship is no longer assigned to embark from venture platform ' + $ventureplatform + ' ' + $ventureplatform.knownname" chance="$debugchance"/>
        <return value="false"/>
      </do_if>

      <!--This order will remain critial until an event that the venture has been completed or aborted-->
      <debug_text text="'setting venture order to critical'" chance="$debugchance"/>
      <set_order_state order="this.assignedcontrolled.order" state="orderstate.critical"/>

      <wait>
        <interrupt>
          <conditions>
            <check_any>
              <check_all>
                <event_venture_mission_completed/>
                <check_value value="event.param2.indexof.{this.assignedcontrolled}"/>
              </check_all>
              <check_all>
                <event_venture_mission_aborted/>
                <check_value value="event.param == this.assignedcontrolled"/>
              </check_all>
            </check_any>
          </conditions>
          <actions>
            <debug_text text="'Venture order inturrpted by event ' + event.name" chance="$debugchance"/>
          </actions>
        </interrupt>
      </wait>

      <debug_text text="'Venture order will now end'" chance="$debugchance"/>
      <return value="true"/>
    </actions>
  </attention>
</aiscript>
